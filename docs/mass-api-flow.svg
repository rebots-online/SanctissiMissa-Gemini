<?xml version="1.0" encoding="UTF-8"?>
<svg width="800" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill: #e1f5fe; stroke: #0277bd; stroke-width: 2; }
      .api-box { fill: #fff3e0; stroke: #ef6c00; stroke-width: 2; }
      .decision { fill: #f3e5f5; stroke: #7b1fa2; stroke-width: 2; }
      .process { fill: #e8f5e8; stroke: #2e7d32; stroke-width: 2; }
      .text { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; }
      .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .arrow { stroke: #424242; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#424242" />
    </marker>
  </defs>
  
  <text x="400" y="30" class="title">Mass Generation API Flow</text>
  
  <!-- User Action -->
  <rect x="300" y="50" width="200" height="40" class="box" />
  <text x="400" y="75" class="text">User selects date</text>
  
  <!-- App.tsx handler -->
  <rect x="280" y="120" width="240" height="40" class="process" />
  <text x="400" y="145" class="text">App.tsx: getMassData(date)</text>
  
  <!-- Loading states -->
  <rect x="50" y="190" width="150" height="40" class="process" />
  <text x="125" y="215" class="text">setLoading(true)</text>
  
  <rect x="220" y="190" width="150" height="40" class="process" />
  <text x="295" y="215" class="text">setError(null)</text>
  
  <rect x="390" y="190" width="150" height="40" class="process" />
  <text x="465" y="215" class="text">setMassData(null)</text>
  
  <!-- API Service Call -->
  <rect x="250" y="260" width="300" height="40" class="api-box" />
  <text x="400" y="285" class="text">fetchLiturgicalData(new Date(date))</text>
  
  <!-- Date formatting -->
  <rect x="250" y="330" width="300" height="40" class="api-box" />
  <text x="400" y="355" class="text">Format date to YYYY-MM-DD</text>
  
  <!-- Prompt construction -->
  <rect x="200" y="400" width="400" height="80" class="api-box" />
  <text x="400" y="425" class="text">Construct AI Prompt:</text>
  <text x="400" y="445" class="text">"You are liturgical expert..."</text>
  <text x="400" y="465" class="text">+ date + schema requirements</text>
  
  <!-- Gemini API Call -->
  <rect x="200" y="510" width="400" height="60" class="api-box" />
  <text x="400" y="535" class="title">GEMINI API CALL</text>
  <text x="400" y="555" class="text">model: gemini-2.5-flash, JSON schema, temp: 0.1</text>
  
  <!-- API Response Decision -->
  <polygon points="400,600 480,640 400,680 320,640" class="decision" />
  <text x="400" y="645" class="text">API Success?</text>
  
  <!-- Error Path -->
  <rect x="550" y="620" width="200" height="40" class="box" />
  <text x="650" y="645" class="text">setError(message)</text>
  
  <!-- Success Path - Parse Response -->
  <rect x="200" y="720" width="400" height="40" class="process" />
  <text x="400" y="745" class="text">Parse JSON response to MassData</text>
  
  <!-- Validation -->
  <polygon points="400,790 480,830 400,870 320,830" class="decision" />
  <text x="400" y="835" class="text">Valid structure?</text>
  
  <!-- Set Mass Data -->
  <rect x="250" y="910" width="300" height="40" class="process" />
  <text x="400" y="935" class="text">setMassData(parsedData)</text>
  
  <!-- Loading cleanup -->
  <rect x="250" y="970" width="300" height="20" class="process" />
  <text x="400" y="985" class="text">setLoading(false)</text>
  
  <!-- Arrows -->
  <line x1="400" y1="90" x2="400" y2="120" class="arrow" />
  <line x1="400" y1="160" x2="400" y2="190" class="arrow" />
  <line x1="125" y1="230" x2="400" y2="260" class="arrow" />
  <line x1="295" y1="230" x2="400" y2="260" class="arrow" />
  <line x1="465" y1="230" x2="400" y2="260" class="arrow" />
  <line x1="400" y1="300" x2="400" y2="330" class="arrow" />
  <line x1="400" y1="370" x2="400" y2="400" class="arrow" />
  <line x1="400" y1="480" x2="400" y2="510" class="arrow" />
  <line x1="400" y1="570" x2="400" y2="600" class="arrow" />
  <line x1="480" y1="640" x2="550" y2="640" class="arrow" />
  <line x1="400" y1="680" x2="400" y2="720" class="arrow" />
  <line x1="400" y1="760" x2="400" y2="790" class="arrow" />
  <line x1="480" y1="830" x2="650" y2="640" class="arrow" />
  <line x1="400" y1="870" x2="400" y2="910" class="arrow" />
  <line x1="400" y1="950" x2="400" y2="970" class="arrow" />
  
  <!-- Labels -->
  <text x="515" y="635" class="text">NO</text>
  <text x="400" y="705" class="text">YES</text>
  <text x="515" y="825" class="text">NO</text>
  <text x="400" y="895" class="text">YES</text>
</svg>